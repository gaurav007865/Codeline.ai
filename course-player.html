<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Course Player | E-LearnPro</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="navbar glass">
    <div class="logo">E-LearnPro</div>
    <nav><a href="courses.html">â† Back to Courses</a></nav>
    <div class="theme-toggle"><button id="themeBtn">ğŸŒ™</button></div>
  </header>

  <div class="player-container fade-up">
    <h2 id="courseTitle">Loading Courseâ€¦</h2>
    <video id="video" width="80%" controls></video>
  </div>

  <footer><p>Tracking your progress automatically ğŸ•’</p></footer>

  <script>
    const params=new URLSearchParams(location.search);
    const videoURL=decodeURIComponent(params.get("video")||"");
    const courseName=decodeURIComponent(params.get("course")||"Unknown Course");
    const email=localStorage.getItem("userEmail")||"guest@unknown";
    const baseScriptURL="https://script.google.com/macros/s/AKfycbxfOQmeZYK8mu2PVdbVuIOn9QXwgGIU4uVGTfz8bdSwmQpQhMTDNZQsmrOics8iSKd6dQ/exec";
    const scriptURL=location.hostname.includes("127.0.0.1")||location.hostname.includes("localhost")
      ?"https://corsproxy.io/?"+encodeURIComponent(baseScriptURL):baseScriptURL;

    const video=document.getElementById("video");
    const title=document.getElementById("courseTitle");
    title.textContent=courseName;
    video.src=videoURL;

    let watch=0;
    setInterval(()=>{if(!video.paused)watch++;},1000);

    window.addEventListener("beforeunload",()=>{
      const min=Math.round(watch/60);
      if(min>0){
        const f=new FormData();
        f.append("action","trackActivity");
        f.append("email",email);
        f.append("courseName",courseName);
        f.append("watchMinutes",min);
        fetch(scriptURL,{method:"POST",body:f});
      }
    });

    // ğŸŒ— Theme toggle
    const btn=document.getElementById("themeBtn");
    const saved=localStorage.getItem("theme");
    if(saved==="dark"){document.body.classList.add("dark");btn.textContent="â˜€ï¸";}
    btn.onclick=()=>{document.body.classList.toggle("dark");
      const dark=document.body.classList.contains("dark");
      btn.textContent=dark?"â˜€ï¸":"ğŸŒ™";
      localStorage.setItem("theme",dark?"dark":"light");};
  </script>
</body>
</html>
